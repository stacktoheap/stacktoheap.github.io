<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Writing a Git provider for Windows Powershell - Part 2</title>
  <meta name="description" content="In this part we look at creating the provider and mounting the default drive at git:\">
  
  <meta name="keywords" content=""/>
  
  <meta content="StackToHeap" property="og:site_name">

  <meta content="Writing a Git provider for Windows Powershell - Part 2" property="og:title">


  <meta content="article" property="og:type">


  <meta content="In this part we look at creating the provider and mounting the default drive at git:\" property="og:description">


  <meta content="https://stacktoheap.com/blog/2012/12/03/writing-a-git-provider-for-windows-powershell-part-2/" property="og:url">


  <meta content="2012-12-03T20:37:00+00:00" property="article:published_time">
  <meta content="https://stacktoheap.com/about/" property="article:author">


  <meta content="https://stacktoheap.com/images/logo-high-resolution.png" property="og:image">


  
  <meta content="powershell" property="article:section">
  


  


  <meta name="twitter:site" value="@manojlds">
<meta name="twitter:creator" value="@manojlds">
<meta name="twitter:card" value="summary_large_image">

<meta name="twitter:image" content="https://stacktoheap.com/images/logo-high-resolution.png">



  <meta name="theme-color" content="#641AE6">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="preload" href="/assets/css/syntax.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/css/syntax.css"></noscript>
  <link rel="canonical" href="https://stacktoheap.com/blog/2012/12/03/writing-a-git-provider-for-windows-powershell-part-2/">
  <link rel="alternate" type="application/rss+xml" title="StackToHeap" href="https://stacktoheap.com/feed.xml">
  <link rel="manifest" href="/manifest.json">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35693303-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


  <body class="font-sans m-0">

    <div class="navbar bg-primary text-primary-content">
  <div class="flex-1">
    <a class="btn btn-ghost normal-case text-xl" href="/" >
      StackToHeap
    </a>
  </div>
  <div class="flex-none">
    <ul class="menu menu-horizontal px-1">
      
        
        <li><a href="/about/">About</a></li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      <li><a href="/feed.xml">RSS</a></li>
    </ul>
  </div>
</div>

    <div class="container mt-12">
        <article class="prose lg:prose-xl lg:leading-normal" itemscope itemtype="http://schema.org/BlogPosting">
  <h1 itemprop="name headline">Writing a Git provider for Windows Powershell - Part 2</h1>
  <p class="post-meta"><time datetime="2012-12-03T20:37:00+00:00" itemprop="datePublished">Dec 3, 2012</time></p>
  <div class="post-content" itemprop="articleBody">
    <p>In <a href="http://stacktoheap.com/blog/2012/12/01/writing-a-git-provider-for-windows-powershell-part-1/">Part 1</a>, I described how to start writing a provider with the corresponding snap-in required to load the provider. In this post, I describe the more exciting part - writing the actual provider code.</p>

<p>To recap, I am trying to write a git provider for Powershell that I can use to manage git repositories on my machine. The provider will create a <code class="language-plaintext highlighter-rouge">git:\</code> drive that will hold my tracked repositories. I can create new repositories or start following existing repositories. I can switch to one of the repositories being tracked. Categorize repositories. And many more ( read - I haven’t fully thought about it yet.)</p>

<p>Let’s start by writing a <code class="language-plaintext highlighter-rouge">GitProvider</code>. A provider can derive from one of the abstract provider types based on what the provider is doing. As a bare minimum, a provider will extend from <code class="language-plaintext highlighter-rouge">DriveCmdletProvider</code>. Depending on what the provider does, a provider may extend from <code class="language-plaintext highlighter-rouge">ItemCmdletProvider</code> or <code class="language-plaintext highlighter-rouge">ContainerCmdletProvider</code> or <code class="language-plaintext highlighter-rouge">NavigationCmdletProvider</code> ( in order of least to most derived.)</p>

<p>As I want the git provider to provide for containers ( categories ) and items ( the git repos themselves ), I am going to have my provider derive from <code class="language-plaintext highlighter-rouge">ContainerCmdletProvider</code>. The bare bones class will look like below:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="p">[</span><span class="nf">CmdletProvider</span><span class="p">(</span><span class="s">"Git"</span><span class="p">,</span> <span class="n">ProviderCapabilities</span><span class="p">.</span><span class="n">None</span><span class="p">)]</span>
<span class="k">class</span> <span class="nc">GitProvider</span> <span class="p">:</span> <span class="n">ContainerCmdletProvider</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">IsValidPath</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">CmdletProvider</code> attribute helps in loading the provider when the snap-in is added and specifies the name of the provider and its capabilities.</p>

<p>Next, we override the <code class="language-plaintext highlighter-rouge">InitializeDefaultDrives</code> method to setup the default drives that are to be loaded when the provider is loaded.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">protected</span> <span class="k">override</span> <span class="n">Collection</span><span class="p">&lt;</span><span class="n">PSDriveInfo</span><span class="p">&gt;</span> <span class="nf">InitializeDefaultDrives</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Collection</span><span class="p">&lt;</span><span class="n">PSDriveInfo</span><span class="p">&gt;</span>
               <span class="p">{</span>
                   <span class="k">new</span> <span class="nf">GitDriveInfo</span><span class="p">(</span><span class="s">"git"</span><span class="p">,</span> <span class="n">ProviderInfo</span><span class="p">,</span> <span class="s">"git:"</span><span class="p">,</span> <span class="s">"Git Provider"</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
               <span class="p">};</span>
<span class="p">}</span></code></pre></figure>

<p>In this case, I setup a <code class="language-plaintext highlighter-rouge">git:</code> drive. <code class="language-plaintext highlighter-rouge">GitDriveInfo</code> is a simple wrapper over <code class="language-plaintext highlighter-rouge">PSDriveInfo</code> to hold state.</p>

<p><img src="https://stacktoheap.com/images/psdrives.png" alt="psdrives" /></p>

<p>If you build and add the registered snap-in, you should be able to see the <code class="language-plaintext highlighter-rouge">git:</code> drive on doing <code class="language-plaintext highlighter-rouge">Get-PSDrive</code></p>

<p>I plan to track the repositories in a <code class="language-plaintext highlighter-rouge">.gitdrive</code> file at <code class="language-plaintext highlighter-rouge">$HOME</code>. It will be a simple CSV file that holds the name of the project / repo and the filesystem path to it:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Name, Path
pit,c:<span class="se">\p</span>roject<span class="se">\o</span>ss<span class="se">\p</span>it</code></pre></figure>

<p>To do that, we need to create the base config file when the provider is loaded, if it doesn’t exist already. We can do that in the <code class="language-plaintext highlighter-rouge">Start</code> method like so:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"> <span class="k">protected</span> <span class="k">override</span> <span class="n">ProviderInfo</span> <span class="nf">Start</span><span class="p">(</span><span class="n">ProviderInfo</span> <span class="n">providerInfo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">gitConfigManager</span><span class="p">.</span><span class="nf">TryCreateConfigFile</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">ProviderInfo</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">gitConfigManager</code> just creates a base csv if it doesn’t already exists.</p>

<p>We can’t switch into our <code class="language-plaintext highlighter-rouge">git:</code> drive just yet, as we haven’t provided much information about it. We now override the <code class="language-plaintext highlighter-rouge">ItemExists</code>method:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">ItemExists</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Currently, the logic is simple. If the path is null or empty, it is the root of the dirve, and we return true for it. As we proceed, we will see if the path is a valid tracked repo path in <code class="language-plaintext highlighter-rouge">ItemExists</code> as well.</p>

<p>We will now be able to <code class="language-plaintext highlighter-rouge">cd git:\</code>. The provider has started taking shape!</p>

  </div>
  
    <div class="divider">Comments</div>
    <section>
      <div id="disqus_thread" aria-live="polite">
<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
      this.page.url = 'https://stacktoheap.com/blog/2012/12/03/writing-a-git-provider-for-windows-powershell-part-2/';
      this.page.identifier = 'https://stacktoheap.com/blog/2012/12/03/writing-a-git-provider-for-windows-powershell-part-2/';
    };
    
    (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://stacktoheap.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
  
</article>

    </div>

    <footer class="footer footer-center p-10 bg-base-200 text-base-content rounded">
  <div class="grid grid-flow-col gap-4">
  </div> 
  <div>
    <div class="grid grid-flow-col gap-4">
      <a href="https://github.com/manojlds"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path></svg></a> 
      <a href="https://github.com/manojlds"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="inline-block h-5 w-5 fill-current md:h-6 md:w-6"><path d="M256,32C132.3,32,32,134.9,32,261.7c0,101.5,64.2,187.5,153.2,217.9a17.56,17.56,0,0,0,3.8.4c8.3,0,11.5-6.1,11.5-11.4,0-5.5-.2-19.9-.3-39.1a102.4,102.4,0,0,1-22.6,2.7c-43.1,0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1,1.4-14.1h.1c22.5,2,34.3,23.8,34.3,23.8,11.2,19.6,26.2,25.1,39.6,25.1a63,63,0,0,0,25.6-6c2-14.8,7.8-24.9,14.2-30.7-49.7-5.8-102-25.5-102-113.5,0-25.1,8.7-45.6,23-61.6-2.3-5.8-10-29.2,2.2-60.8a18.64,18.64,0,0,1,5-.5c8.1,0,26.4,3.1,56.6,24.1a208.21,208.21,0,0,1,112.2,0c30.2-21,48.5-24.1,56.6-24.1a18.64,18.64,0,0,1,5,.5c12.2,31.6,4.5,55,2.2,60.8,14.3,16.1,23,36.6,23,61.6,0,88.2-52.4,107.6-102.3,113.3,8,7.1,15.2,21.1,15.2,42.5,0,30.7-.3,55.5-.3,63,0,5.4,3.1,11.5,11.4,11.5a19.35,19.35,0,0,0,4-.4C415.9,449.2,480,363.1,480,261.7,480,134.9,379.7,32,256,32Z"></path></svg></a> 
    </div>
  </div> 
  <div>
    <p>Copyright © 2023 - StackToHeap</p>
  </div>
</footer>

    <script type="text/javascript">
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
</script>

  </body>

</html>
