<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Writing a Git provider for Windows Powershell - Part 3</title>
  <meta name="description" content="In this final part, we look at implementing some basic Git commands like status, add, commit etc using the provider interface.">
  
  <meta name="keywords" content=""/>
  
  <meta content="StackToHeap" property="og:site_name">

  <meta content="Writing a Git provider for Windows Powershell - Part 3" property="og:title">


  <meta content="article" property="og:type">


  <meta content="In this final part, we look at implementing some basic Git commands like status, add, commit etc using the provider interface." property="og:description">


  <meta content="https://stacktoheap.com/blog/2012/12/07/writing-a-git-provider-for-windows-powershell-part-3/" property="og:url">


  <meta content="2012-12-07T23:59:00+00:00" property="article:published_time">
  <meta content="https://stacktoheap.com/about/" property="article:author">


  <meta content="https://stacktoheap.com/images/logo-high-resolution.png" property="og:image">


  
  <meta content="git" property="article:section">
  


  


  <meta name="twitter:site" value="@manojlds">
<meta name="twitter:creator" value="@manojlds">
<meta name="twitter:card" value="summary_large_image">

<meta name="twitter:image" content="https://stacktoheap.com/images/logo-high-resolution.png">



  <meta name="theme-color" content="#641AE6">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="preload" href="/assets/css/syntax.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/css/syntax.css"></noscript>
  <link rel="canonical" href="https://stacktoheap.com/blog/2012/12/07/writing-a-git-provider-for-windows-powershell-part-3/">
  <link rel="alternate" type="application/rss+xml" title="StackToHeap" href="https://stacktoheap.com/feed.xml">
  <link rel="manifest" href="/manifest.json">
  
  <!-- Theme switching script -->
  <script>
    // Check for saved theme preference or use system preference
    function getTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        return savedTheme;
      }
      
      // Use system preference if no saved theme
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    
    const currentTheme = getTheme();
    document.documentElement.setAttribute('data-theme', currentTheme);
    
    // Set the theme controller checkbox state
    document.addEventListener('DOMContentLoaded', function() {
      const themeController = document.querySelector('.theme-controller');
      if (themeController) {
        themeController.checked = currentTheme === 'dark';
        
        themeController.addEventListener('change', function() {
          const newTheme = this.checked ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      }
      
      // Listen for system theme changes (when user hasn't manually set a preference)
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        if (!localStorage.getItem('theme')) {
          const systemTheme = e.matches ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', systemTheme);
          if (themeController) {
            themeController.checked = systemTheme === 'dark';
          }
        }
      });
    });
  </script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35693303-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


  <body class="font-sans m-0">

    <div class="navbar bg-primary text-primary-content">
  <div class="flex-1">
    <a class="btn btn-ghost normal-case text-xl" href="/" >
      StackToHeap
    </a>
  </div>
  <div class="flex-none">
    <ul class="menu menu-horizontal px-1">
      
        
        <li><a href="/about/">About</a></li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      <li><a href="/feed.xml">RSS</a></li>
      <li>
        <label class="swap swap-rotate btn btn-ghost btn-sm">
          <input type="checkbox" class="theme-controller" value="dark" />
          <!-- sun icon -->
          <svg class="swap-off fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
          </svg>
          <!-- moon icon -->
          <svg class="swap-on fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
          </svg>
        </label>
      </li>
    </ul>
  </div>
</div>

    <div class="container mt-12 p-4">
        <article class="prose lg:prose-xl lg:leading-normal" itemscope itemtype="http://schema.org/BlogPosting">
  <h1 itemprop="name headline">Writing a Git provider for Windows Powershell - Part 3</h1>
  <p class="post-meta"><time datetime="2012-12-07T23:59:00+00:00" itemprop="datePublished">Dec 7, 2012</time></p>
  <div class="post-content" itemprop="articleBody">
    <p>In <a href="http://stacktoheap.com/blog/2012/12/03/writing-a-git-provider-for-windows-powershell-part-2/">Part 2</a>, we saw how to create the provider with a default drive at <code class="language-plaintext highlighter-rouge">git:\</code> and stopped after being able to <code class="language-plaintext highlighter-rouge">cd</code> into the drive. The provider doesn’t really do much, but it is now time to change that.</p>

<p>Once we have the drive, we want to start adding new items to it. Items here are new repos to be tracked. We want to start tracking existing repositories or create and track new repositories. The <code class="language-plaintext highlighter-rouge">New-Item</code> cmdlet is the standard cmdlet to create new items ( normally, it would be a new file or directory.) We will add the ability to support <code class="language-plaintext highlighter-rouge">New-Item</code> to our provider such that it will allow us to implement the scenario described above.</p>

<p>I basically want to start tracking a repo ( let’s keep it simple for now and think about tracking existing repos):</p>

<figure class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="n">New-Item</span><span class="w"> </span><span class="nx">git:\Pit</span><span class="w"> </span><span class="nt">-RepoPath</span><span class="w"> </span><span class="nx">C:\Projects\oss\Pit</span></code></pre></figure>

<p>I want to start tracking the git repo at filesystem location <code class="language-plaintext highlighter-rouge">C:\Projects\oss\Pit</code> at my proivder location <code class="language-plaintext highlighter-rouge">git:\Pit</code>. Of course, <code class="language-plaintext highlighter-rouge">-RepoPath</code> is not a valid parameter to <code class="language-plaintext highlighter-rouge">New-Item</code>. But thankfully, we can add dynamic parameters to provider cmdlets like <code class="language-plaintext highlighter-rouge">New-Item</code> which help in making the providers all the more meaningful and powerful.</p>

<p>We achieve the <code class="language-plaintext highlighter-rouge">New-Item</code> cmdlet support and adding the dynamic parameters by overriding the <code class="language-plaintext highlighter-rouge">NewItem()</code> and <code class="language-plaintext highlighter-rouge">NewItemDynamicParameters()</code> methods.</p>

<p>Let us start off with adding the dynamic parameter <code class="language-plaintext highlighter-rouge">RepoPath</code>:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">protected</span> <span class="k">override</span> <span class="kt">object</span> <span class="nf">NewItemDynamicParameters</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="kt">string</span> <span class="n">itemTypeName</span><span class="p">,</span> <span class="kt">object</span> <span class="n">newItemValue</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">NewItemParameters</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">NewItemParameters</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Parameter</span><span class="p">(</span><span class="n">Mandatory</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">RepoPath</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p><img src="https://stacktoheap.com/images/pitnewitem.PNG" alt="NewItemDynamicParameters" /></p>

<p>In the <code class="language-plaintext highlighter-rouge">NewItemDynamicParameters</code> we simple return an instance of <code class="language-plaintext highlighter-rouge">NewItemParameters</code>. As shown above, <code class="language-plaintext highlighter-rouge">NewItemParameters</code> defines the parameters as properties - in this case just one - that are marked by the <code class="language-plaintext highlighter-rouge">Parameter</code> attribute. Additional details like whether the parameter is mandatory or not can be provided with the attribute. In this case <code class="language-plaintext highlighter-rouge">RepoPath</code> is a mandatory string parameter to New-Item. We can now build and verify that <code class="language-plaintext highlighter-rouge">New-Item</code> does require a <code class="language-plaintext highlighter-rouge">RepoPath</code> parameter when trying to create an item under <code class="language-plaintext highlighter-rouge">git:\</code>. Even tab completion works as expected.</p>

<p>Lets implement the <code class="language-plaintext highlighter-rouge">NewItems</code> method that will do the bulk of the work. You can access the dynamic parameters passed to the cmdlet by using the <code class="language-plaintext highlighter-rouge">DynamicParameters</code> property and casting it to the expected object ( <code class="language-plaintext highlighter-rouge">NewItemParameters</code> ).</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">NewItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="kt">string</span> <span class="n">itemTypeName</span><span class="p">,</span> <span class="kt">object</span> <span class="n">newItemValue</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">newItemParameters</span> <span class="p">=</span> <span class="n">DynamicParameters</span> <span class="k">as</span> <span class="n">NewItemParameters</span><span class="p">;</span>

    <span class="n">gitConfigManager</span><span class="p">.</span><span class="nf">TrackRepo</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">newItemParameters</span><span class="p">.</span><span class="n">RepoPath</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>It is pretty simple. We obtain the <code class="language-plaintext highlighter-rouge">RepoPath</code> from dynamic parameters and pass it to the manager which writes to the config file. Note that the helper ensures that we add it only if it is not being already tracked. In case a repo by the same name is already tracked, and the repo path is different, the path is updated.</p>

<p>It is also simple to add another dynamic parameter like <code class="language-plaintext highlighter-rouge">-New</code> if we want to create a new repository and track it. Note that the <code class="language-plaintext highlighter-rouge">-New</code> parameter will be a switch parameter and will be defined as below:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">NewItemParameters</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">Parameter</span><span class="p">(</span><span class="n">Mandatory</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">RepoPath</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
        <span class="k">public</span> <span class="n">SwitchParameter</span> <span class="n">New</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span></code></pre></figure>

<p>Also <code class="language-plaintext highlighter-rouge">SwitchParameter</code> has a implicit conversion to bool so you can freely use it as a bool to see if you have to create a new repository or not.</p>

<p>Now we are able to create and track repositories from the provider!</p>

  </div>
  
    <div class="divider">Comments</div>
    <section>
      <div id="disqus_thread" aria-live="polite">
<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
      this.page.url = 'https://stacktoheap.com/blog/2012/12/07/writing-a-git-provider-for-windows-powershell-part-3/';
      this.page.identifier = 'https://stacktoheap.com/blog/2012/12/07/writing-a-git-provider-for-windows-powershell-part-3/';
    };
    
    (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://stacktoheap.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
  
</article>

    </div>

    <footer class="footer footer-center p-10 bg-base-200 text-base-content rounded">
  <div class="grid grid-flow-col gap-4">
  </div> 
  <div>
    <div class="grid grid-flow-col gap-4">
      <a href="https://github.com/manojlds"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path></svg></a> 
      <a href="https://github.com/manojlds"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="inline-block h-5 w-5 fill-current md:h-6 md:w-6"><path d="M256,32C132.3,32,32,134.9,32,261.7c0,101.5,64.2,187.5,153.2,217.9a17.56,17.56,0,0,0,3.8.4c8.3,0,11.5-6.1,11.5-11.4,0-5.5-.2-19.9-.3-39.1a102.4,102.4,0,0,1-22.6,2.7c-43.1,0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1,1.4-14.1h.1c22.5,2,34.3,23.8,34.3,23.8,11.2,19.6,26.2,25.1,39.6,25.1a63,63,0,0,0,25.6-6c2-14.8,7.8-24.9,14.2-30.7-49.7-5.8-102-25.5-102-113.5,0-25.1,8.7-45.6,23-61.6-2.3-5.8-10-29.2,2.2-60.8a18.64,18.64,0,0,1,5-.5c8.1,0,26.4,3.1,56.6,24.1a208.21,208.21,0,0,1,112.2,0c30.2-21,48.5-24.1,56.6-24.1a18.64,18.64,0,0,1,5,.5c12.2,31.6,4.5,55,2.2,60.8,14.3,16.1,23,36.6,23,61.6,0,88.2-52.4,107.6-102.3,113.3,8,7.1,15.2,21.1,15.2,42.5,0,30.7-.3,55.5-.3,63,0,5.4,3.1,11.5,11.4,11.5a19.35,19.35,0,0,0,4-.4C415.9,449.2,480,363.1,480,261.7,480,134.9,379.7,32,256,32Z"></path></svg></a> 
    </div>
  </div> 
  <div>
    <p>Copyright © 2023 - StackToHeap</p>
  </div>
</footer>

    <script type="text/javascript">
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
</script>

  </body>

</html>
