<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Getting started with Ansbile for a Django project</title>
  <meta name="description" content="This post walks through setting up a Django project with Ansible for provisioning and deployment.">
  
  <meta name="keywords" content=""/>
  
  <meta content="StackToHeap" property="og:site_name">

  <meta content="Getting started with Ansbile for a Django project" property="og:title">


  <meta content="article" property="og:type">


  <meta content="This post walks through setting up a Django project with Ansible for provisioning and deployment." property="og:description">


  <meta content="https://stacktoheap.com/blog/2013/10/20/getting-started-with-ansbile-for-a-django-project/" property="og:url">


  <meta content="2013-10-20T00:44:00+01:00" property="article:published_time">
  <meta content="https://stacktoheap.com/about/" property="article:author">


  <meta content="https://stacktoheap.com/images/logo-high-resolution.png" property="og:image">


  
  <meta content="ansible" property="article:section">
  


  


  <meta name="twitter:site" value="@manojlds">
<meta name="twitter:creator" value="@manojlds">
<meta name="twitter:card" value="summary_large_image">

<meta name="twitter:image" content="https://stacktoheap.com/images/logo-high-resolution.png">



  <meta name="theme-color" content="#641AE6">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="preload" href="/assets/css/syntax.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/css/syntax.css"></noscript>
  <link rel="canonical" href="https://stacktoheap.com/blog/2013/10/20/getting-started-with-ansbile-for-a-django-project/">
  <link rel="alternate" type="application/rss+xml" title="StackToHeap" href="https://stacktoheap.com/feed.xml">
  <link rel="manifest" href="/manifest.json">
  
  <!-- Theme switching script -->
  <script>
    // Check for saved theme preference or use system preference
    function getTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        return savedTheme;
      }
      
      // Use system preference if no saved theme
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    
    const currentTheme = getTheme();
    document.documentElement.setAttribute('data-theme', currentTheme);
    
    // Set the theme controller checkbox state
    document.addEventListener('DOMContentLoaded', function() {
      const themeController = document.querySelector('.theme-controller');
      if (themeController) {
        themeController.checked = currentTheme === 'dark';
        
        themeController.addEventListener('change', function() {
          const newTheme = this.checked ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      }
      
      // Listen for system theme changes (when user hasn't manually set a preference)
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        if (!localStorage.getItem('theme')) {
          const systemTheme = e.matches ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', systemTheme);
          if (themeController) {
            themeController.checked = systemTheme === 'dark';
          }
        }
      });
    });
  </script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35693303-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


  <body class="font-sans m-0">

    <div class="navbar bg-primary text-primary-content">
  <div class="flex-1">
    <a class="btn btn-ghost normal-case text-xl" href="/" >
      StackToHeap
    </a>
  </div>
  <div class="flex-none">
    <ul class="menu menu-horizontal px-1">
      
        
        <li><a href="/about/">About</a></li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      <li><a href="/feed.xml">RSS</a></li>
      <li>
        <label class="swap swap-rotate btn btn-ghost btn-sm">
          <input type="checkbox" class="theme-controller" value="dark" />
          <!-- sun icon -->
          <svg class="swap-off fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
          </svg>
          <!-- moon icon -->
          <svg class="swap-on fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
          </svg>
        </label>
      </li>
    </ul>
  </div>
</div>

    <div class="container mt-12 p-4">
        <article class="prose lg:prose-xl lg:leading-normal" itemscope itemtype="http://schema.org/BlogPosting">
  <h1 itemprop="name headline">Getting started with Ansbile for a Django project</h1>
  <p class="post-meta"><time datetime="2013-10-20T00:44:00+01:00" itemprop="datePublished">Oct 20, 2013</time></p>
  <div class="post-content" itemprop="articleBody">
    <p>On a Django project, I have been using Chef for configuration management. I am totally happy with Chef. It gets the job done. The community cookbooks are great.</p>

<p>But there’s a new (relatively) kid in the block, by the name of Ansible, and I wanted to try it out for three main reasons:</p>

<p>1) It’s way simpler than existing solutions like Chef and Puppet. From reading the docs, and seeing its yaml based playbooks, it does seem simple to write. My experience with it, enough to write this blog post, does show that it simple, flexible and well thought out.</p>

<p>2) It is written in Python and can be <code class="language-plaintext highlighter-rouge">pip</code> installed. That means no more dependency on Ruby when you are working on a Python project. Also, it provides some Python / Django stack specific modules like the <code class="language-plaintext highlighter-rouge">django_manage</code> and <code class="language-plaintext highlighter-rouge">supervisorctl</code> modules already.</p>

<p>3) It doesn’t need any client software on the machines we intend to bootstrap. All that it would require is Python 2.4 or later ( not Python 3). It gets its job done through ssh. That is great news! Since many distributions have, and need, a relatively recent version of Python 2.X, this means that you don’t need to install ANYTHING on the box being configured to use Ansible.</p>

<h3 id="installing-ansible">Installing Ansible</h3>

<p>I decided to install it through <code class="language-plaintext highlighter-rouge">pip</code> on Mac OS X. <a href="http://www.ansibleworks.com/docs/intro_installation.html">Other installation methods</a> include using the package manager of your OS, or running from source.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pythonbrew venv create test-ansible
pythonbrew venv use test-ansbile
pip <span class="nb">install </span>ansible
pip freeze <span class="o">&gt;</span> requirements.txt</code></pre></figure>

<p>I use pythonbrew for managing my pythons and my virtualenvs, as mentioned in one of my previous blog posts - <a href="/blog/2013/03/11/why-use-virtualenv-when-there-is-pythonbrew/">Why use virtualenv when there is pythonbrew</a></p>

<h3 id="vagrant">Vagrant</h3>

<p>Of course, the next step is to get your Vagrant box up, and test your Ansible provisioning on it. The amazing authors of Vagrant have also provided a provisioner for Ansible, so using Ansible with Vagrant is simpler than it already is.</p>

<p>Do a <code class="language-plaintext highlighter-rouge">vagrant init</code> and configure it to provision with <code class="language-plaintext highlighter-rouge">ansible</code>. Your <code class="language-plaintext highlighter-rouge">Vagrantfile</code> may look something like below:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"debian-7.1.0"</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.33.10"</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"ansible"</span> <span class="k">do</span> <span class="o">|</span><span class="n">ansible</span><span class="o">|</span>
    <span class="n">ansible</span><span class="p">.</span><span class="nf">playbook</span> <span class="o">=</span> <span class="s2">"site.yml"</span>
    <span class="n">ansible</span><span class="p">.</span><span class="nf">inventory_path</span> <span class="o">=</span> <span class="s2">"hosts"</span>
    <span class="n">ansible</span><span class="p">.</span><span class="nf">verbose</span> <span class="o">=</span> <span class="s2">"v"</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>If you have done Chef/Puppet provisioning with Vagrant before, this should be familiar. All that the above does is to enable ansible provisioning and specifies the main playbook - <code class="language-plaintext highlighter-rouge">site.yml</code>. While Vagrant can automatically handle your inventory, I like to explicitly specify the hosts. For now, the <code class="language-plaintext highlighter-rouge">hosts</code> file would look like:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">[</span><span class="n">webservers</span><span class="p">]</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">33.10</span>

<span class="p">[</span><span class="n">dbservers</span><span class="p">]</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">33.10</span></code></pre></figure>

<p>where <code class="language-plaintext highlighter-rouge">webserver</code> and <code class="language-plaintext highlighter-rouge">dbservers</code> are host groups.</p>

<h3 id="directory-layout">Directory Layout</h3>

<p>I decided to follow the directory layout and structure as prescribed in the <a href="http://www.ansibleworks.com/docs/playbooks_best_practices.html">Ansible best practises</a></p>

<h3 id="ansible-playbooks">Ansible Playbooks</h3>

<p>I have setup a top level playbook <code class="language-plaintext highlighter-rouge">site.yml</code>, as mentioned in the VagrantFile, which just includes playbooks for different server roles. It looks something like:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="c1"># file: site.yml</span>
<span class="pi">-</span> <span class="na">include</span><span class="pi">:</span> <span class="s">webservers.yml</span>
<span class="pi">-</span> <span class="na">include</span><span class="pi">:</span> <span class="s">dbservers.yml</span> </code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">webservers.yml</code> and <code class="language-plaintext highlighter-rouge">dbservers.yml</code> look similar to what’s described in the best practises link above.</p>

<h3 id="common-tasks">Common tasks</h3>

<p>Common tasks like updating the apt cache, installing <code class="language-plaintext highlighter-rouge">build-essentials</code> and installing packages like git can be placed in the <code class="language-plaintext highlighter-rouge">common</code> role’s tasks. The playbook for this would look something like:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="c1"># file: roles/common/tasks/main.yml</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">update apt cache</span>
  <span class="na">apt</span><span class="pi">:</span> <span class="s">update_cache=yes cache_valid_time=3600</span>
  <span class="na">tags</span><span class="pi">:</span> <span class="s">apt</span>
  <span class="na">sudo</span><span class="pi">:</span> <span class="s">yes</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">install build essentials</span>
  <span class="na">apt</span><span class="pi">:</span> <span class="s">name=$item state=installed</span>
  <span class="na">with_items</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">autoconf</span>
    <span class="pi">-</span> <span class="s">binutils-doc</span>
    <span class="pi">-</span> <span class="s">bison</span>
    <span class="pi">-</span> <span class="s">build-essential</span>
    <span class="pi">-</span> <span class="s">flex</span>
  <span class="na">sudo</span><span class="pi">:</span> <span class="s">yes</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">install git</span>
  <span class="na">apt</span><span class="pi">:</span> <span class="s">name=git state=latest</span>
  <span class="na">sudo</span><span class="pi">:</span> <span class="s">yes</span></code></pre></figure>

<h3 id="vagrant-provision">Vagrant provision</h3>

<p>We are now ready to provision:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>vagrant provision   <span class="c"># vagrant up</span></code></pre></figure>

<p>Change ansbile verbosity by setting the <code class="language-plaintext highlighter-rouge">ansible.verbose</code> property appropriately in your VagrantFile.</p>

<p>That’s all for this blog post. I will add more posts as I continue to configure the entire stack with Ansible. I am loving Ansible already. It takes the best of Puppet / Chef and comes with a very simplified way of doing configuration management. As I proceed, there will be some roadblocks, but I am looking forward to them as well.</p>

<p>I have setup a repo on Github - <a href="https://github.com/manojlds/django-ansible">django-ansible</a>.</p>

  </div>
  
    <div class="divider">Comments</div>
    <section>
      <div id="disqus_thread" aria-live="polite">
<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
      this.page.url = 'https://stacktoheap.com/blog/2013/10/20/getting-started-with-ansbile-for-a-django-project/';
      this.page.identifier = 'https://stacktoheap.com/blog/2013/10/20/getting-started-with-ansbile-for-a-django-project/';
    };
    
    (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://stacktoheap.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
  
</article>

    </div>

    <footer class="footer footer-center p-10 bg-base-200 text-base-content rounded">
  <div class="grid grid-flow-col gap-4">
  </div> 
  <div>
    <div class="grid grid-flow-col gap-4">
      <a href="https://github.com/manojlds"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="fill-current"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path></svg></a> 
      <a href="https://github.com/manojlds"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="inline-block h-5 w-5 fill-current md:h-6 md:w-6"><path d="M256,32C132.3,32,32,134.9,32,261.7c0,101.5,64.2,187.5,153.2,217.9a17.56,17.56,0,0,0,3.8.4c8.3,0,11.5-6.1,11.5-11.4,0-5.5-.2-19.9-.3-39.1a102.4,102.4,0,0,1-22.6,2.7c-43.1,0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1,1.4-14.1h.1c22.5,2,34.3,23.8,34.3,23.8,11.2,19.6,26.2,25.1,39.6,25.1a63,63,0,0,0,25.6-6c2-14.8,7.8-24.9,14.2-30.7-49.7-5.8-102-25.5-102-113.5,0-25.1,8.7-45.6,23-61.6-2.3-5.8-10-29.2,2.2-60.8a18.64,18.64,0,0,1,5-.5c8.1,0,26.4,3.1,56.6,24.1a208.21,208.21,0,0,1,112.2,0c30.2-21,48.5-24.1,56.6-24.1a18.64,18.64,0,0,1,5,.5c12.2,31.6,4.5,55,2.2,60.8,14.3,16.1,23,36.6,23,61.6,0,88.2-52.4,107.6-102.3,113.3,8,7.1,15.2,21.1,15.2,42.5,0,30.7-.3,55.5-.3,63,0,5.4,3.1,11.5,11.4,11.5a19.35,19.35,0,0,0,4-.4C415.9,449.2,480,363.1,480,261.7,480,134.9,379.7,32,256,32Z"></path></svg></a> 
    </div>
  </div> 
  <div>
    <p>Copyright © 2023 - StackToHeap</p>
  </div>
</footer>

    <script type="text/javascript">
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
</script>

  </body>

</html>
